<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>

    <h1>send code</h1>
    <div id="editor" style="min-height: 200px;"></div>
    <button onclick="sendcode()">send code</button>

    <h1>log</h1>
    <button onclick="startLog()">start</button>
    <button onclick="endLog()">end</button>
    <div id="log"></div>


    <script type="module">
        import { EditorView, basicSetup } from "https://esm.sh/codemirror"
        import { javascript } from "https://esm.sh/@codemirror/lang-javascript"


        window.editor = new EditorView({
            extensions: [basicSetup, javascript()],
            parent: document.querySelector('#editor')
        })
    </script>

    <script>

        function sendcode() {
            fetch('/code', {
                method: 'post',
                headers: {
                    'Content-Type': "application/json"
                },
                body: JSON.stringify({
                    code: editor.state.doc.toString()
                })
            }).then(r => r.json()).then(r => {
                console.log(r)
            })
        }

        var timer = null

        function startLog() {
            timer = setInterval(() => {
                fetch('/slog').then(res => res.text()).then(log => {
                    let p = document.createElement('p')
                    p.style.border = '1px solid'
                    p.innerHTML = log
                    document.querySelector('#log').prepend(log ? p : '')
                })
            }, 1000)
        }
        function endLog() {
            console.log(timer)
            if (timer) {
                clearInterval(timer)
            }
            document.querySelector('#log').replaceChildren();
        }
    </script>
</body>

</html>